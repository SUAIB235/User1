<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TRX Dice Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen p-4">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold"><i class="fas fa-dice mr-2"></i>Dice Game</h1>
    <div class="relative group">
      <button class="text-gray-700 hover:text-black">
        <i class="fas fa-user-circle fa-2x"></i>
      </button>
      <div class="absolute right-0 bg-white border mt-2 rounded-lg shadow-md p-4 hidden group-hover:block z-10 min-w-[220px]">
        <p class="text-xs text-gray-500 mb-1">Connected:</p>
        <p class="text-sm font-mono mb-2" id="userAddress"></p>
        <button class="bg-green-500 text-white text-sm px-4 py-1 rounded mb-2 w-full">Deposit</button>
        <button class="bg-red-500 text-white text-sm px-4 py-1 rounded w-full">Withdraw</button>
      </div>
    </div>
  </div>

  <!-- Balance -->
  <div class="text-right text-sm text-gray-600 mb-4">
    Balance: <span id="balance">-- TRX</span>
  </div>

  <!-- Betting Controls -->
  <div class="bg-white p-6 rounded-xl shadow-md max-w-md mx-auto">
    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Select Bet Amount</label>
      <div id="betOptions" class="flex gap-2 flex-wrap"></div>
    </div>

    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Choose Side</label>
      <div class="flex gap-4">
        <button id="oddBtn" class="side-btn bg-blue-100 hover:bg-blue-200 px-4 py-2 rounded">Odd</button>
        <button id="evenBtn" class="side-btn bg-purple-100 hover:bg-purple-200 px-4 py-2 rounded">Even</button>
      </div>
    </div>

    <button id="rollBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">Roll Dice</button>

    <!-- Dice Display -->
    <div class="text-center mt-6">
      <i id="diceIcon" class="fas fa-dice fa-4x text-gray-600 mb-2"></i>
      <div id="result" class="text-lg font-semibold mt-2"></div>
    </div>
  </div>

  <script>
    // Redirect if not connected
    if (localStorage.getItem("trx_connected") !== "true") {
      window.location.href = "index.html";
    }

    const address = localStorage.getItem("trx_address");
    document.getElementById("userAddress").textContent = address || "Not Connected";

    // Fake balance (replace later with tronWeb.trx.getBalance)
    let balance = 100; // Simulated balance in TRX
    let selectedBet = 0.1;
    let selectedSide = "odd";

    const balanceDisplay = document.getElementById("balance");
    const resultDiv = document.getElementById("result");
    const diceIcon = document.getElementById("diceIcon");

    function updateBalanceDisplay() {
      balanceDisplay.textContent = `${balance.toFixed(2)} TRX`;
    }

    // Render bet buttons
    const betOptions = [0.1, 0.2, 0.3, 0.4, 0.5];
    const betContainer = document.getElementById("betOptions");
    betOptions.forEach(amount => {
      const btn = document.createElement("button");
      btn.className = "bet-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded";
      btn.textContent = `${amount} TRX`;
      btn.dataset.value = amount;
      if (amount === 0.1) btn.classList.add("bg-yellow-200"); // Default selected

      btn.addEventListener("click", () => {
        selectedBet = parseFloat(btn.dataset.value);
        document.querySelectorAll(".bet-btn").forEach(b => b.classList.remove("bg-yellow-200"));
        btn.classList.add("bg-yellow-200");
      });

      betContainer.appendChild(btn);
    });

    // Side selection
    document.getElementById("oddBtn").addEventListener("click", () => {
      selectedSide = "odd";
      document.getElementById("oddBtn").classList.add("bg-yellow-200");
      document.getElementById("evenBtn").classList.remove("bg-yellow-200");
    });

    document.getElementById("evenBtn").addEventListener("click", () => {
      selectedSide = "even";
      document.getElementById("evenBtn").classList.add("bg-yellow-200");
      document.getElementById("oddBtn").classList.remove("bg-yellow-200");
    });

    // Dice faces map
    const diceFaces = {
      1: "fa-dice-one",
      2: "fa-dice-two",
      3: "fa-dice-three",
      4: "fa-dice-four",
      5: "fa-dice-five",
      6: "fa-dice-six",
    };

    // Roll Button
    document.getElementById("rollBtn").addEventListener("click", () => {
      if (balance < selectedBet) {
        resultDiv.textContent = "❌ Not enough balance!";
        return;
      }

      balance -= selectedBet;
      updateBalanceDisplay();

      const result = Math.floor(Math.random() * 6) + 1;
      const isWin = (result % 2 === 0 && selectedSide === "even") || (result % 2 !== 0 && selectedSide === "odd");

      // Show dice face
      diceIcon.className = `fas ${diceFaces[result]} fa-4x text-gray-600`;

      // Show result
      resultDiv.textContent = `🎲 Rolled: ${result} — You ${isWin ? "Win 🎉" : "Lose ❌"}`;

      if (isWin) {
        balance += selectedBet * 2;
        updateBalanceDisplay();
      }
    });

    updateBalanceDisplay();
  </script>
</body>
</html>
