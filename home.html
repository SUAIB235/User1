<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TRX Dice Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .modal-bg {
      background-color: rgba(0, 0, 0, 0.6);
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen p-4">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold"><i class="fas fa-dice mr-2"></i>Dice Game</h1>
    <div class="relative group">
      <button class="text-gray-700 hover:text-black" id="accountBtn">
        <i class="fas fa-user-circle fa-2x"></i>
      </button>
      <div class="absolute right-0 bg-white border mt-2 rounded-lg shadow-md p-4 hidden group-hover:block z-10 min-w-[220px]">
        <p class="text-xs text-gray-500 mb-1">Connected:</p>
        <p class="text-sm font-mono mb-2" id="userAddress"></p>
        <button class="bg-green-500 text-white text-sm px-4 py-1 rounded mb-2 w-full" id="depositBtn">Deposit</button>
        <button class="bg-red-500 text-white text-sm px-4 py-1 rounded w-full">Withdraw</button>
      </div>
    </div>
  </div>

  <!-- Balance -->
  <div class="text-right text-sm text-gray-600 mb-4">
    Balance: <span id="balance">-- TRX</span>
  </div>

  <!-- Game Box -->
  <div class="bg-white p-4 rounded-xl shadow-md max-w-sm mx-auto">
    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Select Bet Amount</label>
      <div id="betOptions" class="flex gap-2 flex-wrap"></div>
    </div>

    <div class="mb-4">
      <label class="block text-sm font-medium mb-2">Choose Side</label>
      <div class="flex gap-4">
        <button id="oddBtn" class="side-btn bg-red-100 hover:bg-red-200 px-4 py-2 rounded">Odd</button>
        <button id="evenBtn" class="side-btn bg-green-100 hover:bg-green-200 px-4 py-2 rounded">Even</button>
      </div>
    </div>

    <button id="rollBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">Roll Dice</button>

    <!-- Dice Display -->
    <div class="text-center mt-6">
      <i id="diceIcon" class="fas fa-dice fa-4x text-gray-600 mb-2"></i>
      <div id="result" class="text-lg font-semibold mt-2"></div>
    </div>
  </div>

  <!-- Deposit Modal -->
  <div id="depositModal" class="fixed inset-0 hidden items-center justify-center modal-bg z-20">
    <div class="bg-white p-6 rounded-xl w-80 shadow-lg relative">
      <button id="closeModal" class="absolute top-2 right-3 text-gray-500 hover:text-black text-lg">&times;</button>
      <h2 class="text-xl font-bold mb-4">Deposit TRX</h2>
      <div class="flex justify-center mb-4">
        <img src="https://api.qrserver.com/v1/create-qr-code/?data=TRX_DEPOSIT_ADDRESS_HERE&size=150x150" alt="QR Code" />
      </div>
      <p class="text-sm text-center font-mono break-all">TRX_DEPOSIT_ADDRESS_HERE</p>
      <p class="text-xs text-gray-500 text-center mt-2">Send only TRX. Funds appear after confirmation.</p>
    </div>
  </div>

  <script>
    if (localStorage.getItem("trx_connected") !== "true") {
      window.location.href = "index.html";
    }

    const address = localStorage.getItem("trx_address");
    document.getElementById("userAddress").textContent = address || "Not Connected";

    let balance = parseFloat(localStorage.getItem("trx_balance") || "5"); // 5 TRX welcome bonus
    let selectedBet = null;
    let selectedSide = null;

    const balanceDisplay = document.getElementById("balance");
    const resultDiv = document.getElementById("result");
    const diceIcon = document.getElementById("diceIcon");

    function updateBalanceDisplay() {
      balanceDisplay.textContent = `${balance.toFixed(2)} TRX`;
      localStorage.setItem("trx_balance", balance);
    }

    // Render bet buttons
    const betOptions = [0.1, 0.2, 0.3, 0.4, 0.5];
    const betContainer = document.getElementById("betOptions");

    betOptions.forEach(amount => {
      const btn = document.createElement("button");
      btn.className = "bet-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded";
      btn.textContent = `${amount} TRX`;
      btn.dataset.value = amount;

      btn.addEventListener("click", () => {
        selectedBet = parseFloat(btn.dataset.value);
        document.querySelectorAll(".bet-btn").forEach(b => b.classList.remove("bg-yellow-300"));
        btn.classList.add("bg-yellow-300");
      });

      betContainer.appendChild(btn);
    });

    // Side selection
    document.getElementById("oddBtn").addEventListener("click", () => {
      selectedSide = "odd";
      document.getElementById("oddBtn").classList.add("bg-yellow-300");
      document.getElementById("evenBtn").classList.remove("bg-yellow-300");
    });

    document.getElementById("evenBtn").addEventListener("click", () => {
      selectedSide = "even";
      document.getElementById("evenBtn").classList.add("bg-yellow-300");
      document.getElementById("oddBtn").classList.remove("bg-yellow-300");
    });

    // Dice face map
    const diceFaces = {
      1: "fa-dice-one",
      2: "fa-dice-two",
      3: "fa-dice-three",
      4: "fa-dice-four",
      5: "fa-dice-five",
      6: "fa-dice-six",
    };

    // Roll dice
    document.getElementById("rollBtn").addEventListener("click", () => {
      resultDiv.textContent = "";

      if (!selectedBet || !selectedSide) {
        resultDiv.textContent = "‚ùó Please select bet amount and side.";
        return;
      }

      if (balance < selectedBet) {
        resultDiv.textContent = "‚ùå Not enough balance!";
        return;
      }

      balance -= selectedBet;
      updateBalanceDisplay();

      const roll = Math.floor(Math.random() * 6) + 1;
      const isWin = (roll % 2 === 0 && selectedSide === "even") || (roll % 2 !== 0 && selectedSide === "odd");

      diceIcon.className = `fas ${diceFaces[roll]} fa-4x text-gray-600`;
      resultDiv.textContent = `üé≤ Rolled: ${roll} ‚Äî You ${isWin ? "Win üéâ" : "Lose ‚ùå"}`;

      if (isWin) {
        balance += selectedBet * 2;
        updateBalanceDisplay();
      }
    });

    // Deposit modal logic
    const depositModal = document.getElementById("depositModal");
    document.getElementById("depositBtn").addEventListener("click", () => {
      depositModal.classList.remove("hidden");
    });

    document.getElementById("closeModal").addEventListener("click", () => {
      depositModal.classList.add("hidden");
    });

    // Simulate balance update every 10 seconds (for demo)
    setInterval(() => {
      // Replace with real check from wallet/contract
      const randomChance = Math.random();
      if (randomChance > 0.98) {
        const depositAmount = 1 + Math.random(); // Simulated deposit
        balance += depositAmount;
        updateBalanceDisplay();
        console.log(`üí∏ Simulated deposit: ${depositAmount.toFixed(2)} TRX`);
      }
    }, 10000);

    updateBalanceDisplay();
  </script>
</body>
</html>
